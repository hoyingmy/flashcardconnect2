<!DOCTYPE html>
<html>
<head>
  <title>Interactive Flashcard</title>
  <!-- Load p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <!-- Load ML5.js library -->
  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>
  <!-- Load Jua font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #000;
    }
    canvas {
      display: block;
      border-radius: 20px;
      overflow: hidden;
      border: 1pt solid #D9DD3A;
    }
    video {
      border-radius: 20px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <script>
    let video;
    let label = "Please Display Flashcard";
    let classifier;
    let modelURL = 'https://teachablemachine.withgoogle.com/models/9Ca5bP4Ev/';
    let feedback = ""; // To store check or X
    let showSecondQuestion = false; // State to track second question display

    function preload() {
      classifier = ml5.imageClassifier(modelURL + 'model.json');
    }

    function setup() {
      // Use the video's natural dimensions
      video = createCapture(VIDEO, function(stream) {
        let w = video.width;
        let h = video.height;
        createCanvas(w, h);
        video.hide();
        classifyVideo();
      });
    }

    function classifyVideo() {
      classifier.classify(video, gotResults);
    }

    function draw() {
      background(0);
      image(video, 0, 0, width, height); // Scale video to fit canvas

      // Set Jua font for all text
      textFont('Jua');

      // Display based on question state
      if (!showSecondQuestion) {
        // Draw solid background in the top 1/3 for first question
        fill(82, 81, 158); // #52519E
        noStroke();
        rect(0, 0, width, height / 3);

        // Display the first question prominently at the top
        textSize(30);
        textAlign(CENTER, TOP);
        fill(255);
        text("What is art?", width / 2, 20);
        
        // Display first question answer options with aligned starting points, moved 50 pixels to the left
        textSize(16);
        textAlign(LEFT, TOP);
        let xOffset = width / 2 + 10 - 50;
        text("A. Subject", xOffset, 60);
        text("B. Unsure", xOffset, 80);
        text("C. Colors", xOffset, 100);
        text("D. Images", xOffset, 120);

        // Only display the letter and feedback if a flashcard (A, B, C, or D) is detected for first question
        if (label === "A" || label === "B" || label === "C" || label === "D") {
          let emoji = label; // Use the detected label directly
          textSize(150);
          text(emoji, width / 2 - 80, height / 2);

          // Display feedback (green check for B, red X for others)
          if (label === "B") {
            fill(0, 255, 0); // Green
            textSize(150);
            text("✓", width / 2 + 50, height / 2);
            showSecondQuestion = true; // Trigger second question display
          } else if (label === "A" || label === "C" || label === "D") {
            fill(255, 0, 0); // Red
            textSize(150);
            text("✗", width / 2 + 50, height / 2);
          }
        }
      } else {
        // Draw solid background in the top 1/3 for second question
        fill(82, 81, 158); // #52519E
        noStroke();
        rect(0, 0, width, height / 3);

        // Display the second question prominently at the top
        textSize(30);
        textAlign(CENTER, TOP);
        fill(255);
        text("What is the second question?", width / 2, 20);
        
        // Display second question answer options with aligned starting points, moved 50 pixels to the left
        textSize(16);
        textAlign(LEFT, TOP);
        let xOffset = width / 2 + 10 - 50;
        text("A. Answer 1", xOffset, 60);
        text("B. Answer 2", xOffset, 80);
        text("C. Answer 3", xOffset, 100);
        text("D. Answer 4", xOffset, 120);

        // Display feedback for second question
        if (label === "A" || label === "B" || label === "C" || label === "D") {
          textSize(150);
          text(label, width / 2 - 80, height / 2);

          if (label === "D") {
            fill(0, 255, 0); // Green check for correct answer
            textSize(150);
            text("✓", width / 2 + 50, height / 2);
          } else if (label === "A" || label === "B" || label === "C") {
            fill(255, 0, 0); // Red X for incorrect answers
            textSize(150);
            text("✗", width / 2 + 50, height / 2);
          }
        }
      }
    }

    function gotResults(error, results) {
      if (error) {
        console.error(error);
        return;
      }
      label = results[0].label;
      classifyVideo();
    }
  </script>
</body>
</html>
